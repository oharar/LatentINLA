---
title: "SpiderGLLVM"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SpiderGLLVM}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Spider Data GLLVM

This is an analysis the much-used spider data. Everyone else uses is, so we will too.

First, set up and get the data:

```{r setup}
library(LatentINLA)
library(mvabund)
data(spider)

Y<-spider$abund
```

We will use 2 latent variables. First we fit the model (of course)

```{r FormatData, eval=TRUE}
Spiders <- FitGLLVM(Y=spider$abund, Family="poisson", nLVs = 2, 
                    ColPriorsd=1)

```

We can admire our wonderful ordination plot:

```{r Biplot, eval=TRUE, fig.height=5, fig.width=6}
biplot(Spiders)

```

We have also estimated our site and species main effects. First the sites. The confidence intervals are disappointingly wide.


```{r PlotSites, fig.height=5, fig.width=5}
plotterm <- function(t, ...) {
  plot(t$mean, 1:nrow(t), xlim=c(min(t$'0.025quant'), max(t$'0.975quant')),
       yaxt="n", ...)
  segments(t$'0.025quant', 1:nrow(t), t$'0.975quant', 1:nrow(t))
  axis(2, rownames(t), at=1:nrow(t), las=1)
}
rownames(Spiders$rowterm) <- rownames(Spiders$Y)
par(mar=c(4.1,4,1,1))
plotterm(Spiders$rowterm, xlab="Site Mean Effect", ylab="")
mtext("Site", 2, line =5)

```
And then the species:

```{r PlotSpecies, fig.height=5, fig.width=4}
par(mar=c(4.1,6,1,1))
rownames(Spiders$colterm) <- colnames(Spiders$Y)[-1] # might not be right
plotterm(Spiders$colterm, xlab="Species Mean Effect", ylab="")
mtext("Species", 2, line =5)
```

From this we can conclude that some species are rarer than others.
